<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-touch-fullscreen" content="yes"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="theme-color" content="#0a0a0a"/>
  <title>ELITE TRAINING</title>
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%230a0a0a'/><text y='.9em' font-size='90'>üí™</text></svg>"/>
  <style>
    /* System fonts - works 100% offline, no network requests */
    .bebas-font { font-family: 'Impact', 'Arial Narrow', 'Arial Black', sans-serif; letter-spacing: 2px; }
  </style>
  <style>
    :root{
      --accent:#00ff88;--bg:#0a0a0a;--card:#111;--border:#1a1a1a;
      --sat: env(safe-area-inset-top, 0px);
      --sab: env(safe-area-inset-bottom, 0px);
      --sal: env(safe-area-inset-left, 0px);
      --sar: env(safe-area-inset-right, 0px);
    }
    *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
    html{height:100%;background:var(--bg);}
    body{background:var(--bg);color:#f0f0f0;font-family:-apple-system,BlinkMacSystemFont,'Helvetica Neue','Segoe UI',sans-serif;min-height:100%;min-height:-webkit-fill-available;overscroll-behavior:none;-webkit-overflow-scrolling:touch;}
    .bebas{font-family:Impact,'Arial Narrow','Arial Black',sans-serif;}
    #app{max-width:480px;margin:0 auto;min-height:100vh;min-height:-webkit-fill-available;padding-bottom:calc(32px + var(--sab));}
    ::-webkit-scrollbar{width:3px;}
    ::-webkit-scrollbar-thumb{background:#333;border-radius:2px;}

    /* HEADER */
    .header{padding:calc(16px + var(--sat)) 20px 14px;padding-top:max(52px, calc(16px + var(--sat)));border-bottom:1px solid var(--border);background:var(--bg);position:sticky;top:0;z-index:20;display:flex;justify-content:space-between;align-items:flex-start;}
    .h-eyebrow{font-size:10px;letter-spacing:4px;color:#444;margin-bottom:2px;}
    .h-phase{font-size:30px;letter-spacing:2px;line-height:1;}
    .h-sub{font-size:12px;margin-top:2px;}
    .h-date{font-size:11px;color:#444;margin-top:4px;}
    .prog-circle{width:52px;height:52px;border-radius:50%;border:2px solid var(--accent);display:flex;align-items:center;justify-content:center;flex-direction:column;flex-shrink:0;}
    .prog-num{font-size:17px;line-height:1;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;}
    .prog-pct{font-size:8px;color:#555;}

    /* MAIN TABS */
    .tabs{display:flex;border-bottom:1px solid var(--border);background:var(--bg);position:sticky;top:var(--header-h, 100px);z-index:19;overflow-x:auto;}
    .tabs::-webkit-scrollbar{display:none;}
    .tab-btn{flex-shrink:0;padding:11px 12px;background:none;border:none;border-bottom:2px solid transparent;color:#444;font-size:12px;letter-spacing:1.5px;cursor:pointer;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;transition:all 0.2s;white-space:nowrap;}
    .tab-btn.active{border-bottom-color:var(--accent);color:var(--accent);}

    /* DAY SELECTOR TABS */
    .day-tabs{display:flex;padding:12px 20px 0;gap:6px;overflow-x:auto;}
    .day-tabs::-webkit-scrollbar{display:none;}
    .day-tab{flex-shrink:0;padding:8px 12px;border-radius:8px 8px 0 0;font-size:12px;letter-spacing:1px;cursor:pointer;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;background:none;color:#444;border:1px solid #1e1e1e;border-bottom:none;transition:all 0.15s;white-space:nowrap;}
    .day-tab.active{color:var(--accent);border-color:var(--accent);background:#141414;}
    .day-tab.rest-day.active{color:#6699ff;border-color:#6699ff;}
    .day-tab.recovery-day.active{color:#ffcc00;border-color:#ffcc00;}
    .day-tab.hiit-day.active{color:#ff88aa;border-color:#ff88aa;}

    /* PHASE PILLS */
    .phase-row{padding:12px 20px 8px;display:flex;gap:8px;}
    .phase-btn{flex:1;padding:7px 4px;border-radius:6px;font-size:14px;letter-spacing:1px;cursor:pointer;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;border:1px solid #222;background:#141414;color:#555;transition:all 0.2s;}
    .phase-btn.active{color:#000;}

    /* DAY CARD */
    .day-card{margin:0 20px 14px;background:var(--card);border-radius:0 10px 10px 10px;padding:14px 16px;border-left:3px solid var(--accent);}
    .day-name{font-size:24px;letter-spacing:1px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;}
    .day-tag{font-size:12px;color:#666;margin-top:2px;}

    /* INFO BOXES */
    .info-box{margin:0 20px 10px;border-radius:8px;padding:11px 14px;display:flex;align-items:center;gap:10px;}
    .info-box.warm{background:#0d1a12;border:1px solid #1a2e1f;}
    .info-box.cool{background:#110d1a;border:1px solid #1e1a2e;}
    .info-box.note{background:#1a1a0d;border:1px solid #2e2e1a;}
    .info-box.blue{background:#0d0f1a;border:1px solid #1a2030;}
    .box-icon{font-size:16px;flex-shrink:0;}
    .box-lbl{font-size:9px;color:#555;letter-spacing:2px;}
    .box-txt{font-size:12px;margin-top:1px;}

    /* PROGRESS BAR */
    .prog-bar-wrap{padding:0 20px 14px;}
    .prog-bar-labels{display:flex;justify-content:space-between;margin-bottom:5px;font-size:10px;letter-spacing:2px;color:#444;}
    .prog-bar-track{height:3px;background:#1a1a1a;border-radius:2px;}
    .prog-bar-fill{height:100%;background:var(--accent);border-radius:2px;transition:width 0.3s ease;}

    /* EXERCISE ITEMS */
    .ex-section{padding:0 20px;}
    .section-lbl{font-size:10px;letter-spacing:3px;color:#444;margin-bottom:8px;}
    .section-lbl.pink{color:#ff88aa;}
    .section-lbl.yellow{color:#ffcc00;}
    .section-lbl.blue{color:#6699ff;}
    .ex-item{margin-bottom:8px;background:var(--card);border-radius:10px;border:1px solid var(--border);overflow:hidden;transition:border-color 0.15s;}
    .ex-item.done{border-color:#1a3a1a;background:#0d1a0d;}
    .ex-item.body-item.done{border-color:#1a1a3a;background:#0d0d1a;}
    .ex-top{display:flex;align-items:center;gap:12px;padding:12px 14px;cursor:pointer;}
    .ex-check{width:22px;height:22px;border-radius:5px;border:2px solid #333;background:none;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.15s;}
    .ex-check.checked{background:var(--accent);border-color:var(--accent);}
    .ex-check.checked::after{content:'‚úì';color:#000;font-size:12px;font-weight:bold;}
    .ex-check.blue-check{border-color:#2a2a44;}
    .ex-check.blue-check.checked{background:#6699ff;border-color:#6699ff;}
    .ex-check.yellow-check{border-color:#44440a;}
    .ex-check.yellow-check.checked{background:#ffcc00;border-color:#ffcc00;}
    .ex-info{flex:1;}
    .ex-name{font-size:14px;letter-spacing:0.3px;transition:all 0.15s;}
    .ex-item.done .ex-name{color:#444;text-decoration:line-through;}
    .ex-note{font-size:11px;color:#555;margin-top:2px;}
    .ex-reps-badge{font-size:12px;color:var(--accent);text-align:right;flex-shrink:0;white-space:nowrap;}
    .ex-reps-badge.blue{color:#6699ff;}
    .ex-reps-badge.yellow{color:#ffcc00;}

    /* WEIGHT INPUT */
    .ex-weight{padding:0 14px 12px;display:none;}
    .ex-weight.open{display:block;}
    .weight-row{display:flex;align-items:center;gap:10px;}
    .weight-lbl{font-size:10px;color:#555;letter-spacing:2px;flex-shrink:0;}
    .weight-input{flex:1;background:#0a0a0a;border:1px solid #2a2a2a;border-radius:6px;padding:7px 10px;color:#f0f0f0;font-size:14px;font-family:-apple-system,BlinkMacSystemFont,'Helvetica Neue',sans-serif;outline:none;}
    .weight-input:focus{border-color:var(--accent);}
    .weight-unit{font-size:12px;color:#555;}
    .weight-note{font-size:10px;color:#444;margin-top:5px;font-style:italic;}

    /* RECOVERY CHECKLIST ITEMS */
    .rec-item{display:flex;align-items:flex-start;gap:12px;padding:12px 14px;margin:0 20px 8px;background:var(--card);border-radius:10px;border:1px solid var(--border);cursor:pointer;transition:all 0.15s;}
    .rec-item.done{background:#0d1a0d;border-color:#1a3a1a;}
    .rec-item.blue-rec.done{background:#0d0f1a;border-color:#1a2030;}
    .rec-check{width:20px;height:20px;border-radius:4px;border:2px solid #333;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;transition:all 0.15s;}
    .rec-check.checked{background:var(--accent);border-color:var(--accent);}
    .rec-check.checked::after{content:'‚úì';color:#000;font-size:11px;font-weight:bold;}
    .rec-check.blue-rc.checked{background:#6699ff;border-color:#6699ff;}
    .rec-check.pink-rc.checked{background:#ff88aa;border-color:#ff88aa;}
    .rec-check.yellow-rc.checked{background:#ffcc00;border-color:#ffcc00;}
    .rec-text{font-size:13px;line-height:1.3;}
    .rec-item.done .rec-text{color:#444;text-decoration:line-through;}
    .rec-detail{font-size:11px;color:#555;margin-top:3px;line-height:1.4;}

    /* SUPPS */
    .supp-item{display:flex;align-items:center;gap:12px;padding:13px 16px;margin:0 20px 8px;background:var(--card);border-radius:10px;border:1px solid var(--border);cursor:pointer;transition:all 0.15s;}
    .supp-item.done{background:#0d1a0d;border-color:#1a3a1a;}
    .supp-check{width:22px;height:22px;border-radius:5px;border:2px solid #333;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.15s;}
    .supp-check.checked{background:var(--accent);border-color:var(--accent);}
    .supp-check.checked::after{content:'‚úì';color:#000;font-size:12px;font-weight:bold;}
    .supp-info{flex:1;}
    .supp-name{font-size:15px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;letter-spacing:0.5px;}
    .supp-item.done .supp-name{color:#444;text-decoration:line-through;}
    .supp-detail{font-size:11px;color:#555;margin-top:2px;}
    .supp-dose{font-size:10px;color:#000;padding:2px 8px;border-radius:20px;font-weight:600;white-space:nowrap;flex-shrink:0;}
    .sex-item{display:flex;align-items:center;gap:12px;padding:13px 16px;margin-bottom:8px;background:var(--card);border-radius:10px;border:1px solid #2a1a20;cursor:pointer;transition:all 0.15s;}
    .sex-item.done{background:#1a0d12;border-color:#3a1a22;}
    .sex-check{width:22px;height:22px;border-radius:5px;border:2px solid #3a1a2a;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.15s;}
    .sex-check.checked{background:#ff88aa;border-color:#ff88aa;}
    .sex-check.checked::after{content:'‚úì';color:#000;font-size:12px;font-weight:bold;}

    /* CALENDAR */
    .cal-wrap{padding:14px 20px;}
    .cal-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
    .cal-month{font-size:22px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;letter-spacing:2px;}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;}
    .cal-dow{font-size:10px;color:#444;text-align:center;padding:4px 0;letter-spacing:1px;}
    .cal-day{aspect-ratio:1;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:pointer;border:1px solid transparent;transition:all 0.15s;color:#555;}
    .cal-day.empty{cursor:default;}
    .cal-day.today{border-color:var(--accent);color:#fff;}
    .cal-day.trained{background:var(--accent);color:#000;font-weight:600;}
    .cal-day.partial{background:#1a3a1a;color:var(--accent);}
    .cal-day.rest{background:#1a1a2e;color:#6699ff;}
    .nav-btn{background:none;border:1px solid #2a2a2a;border-radius:6px;color:#888;padding:5px 12px;cursor:pointer;font-size:16px;}

    /* MODAL */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:100;display:flex;align-items:flex-end;justify-content:center;}
    .modal{background:#111;border-radius:20px 20px 0 0;padding:24px 20px 40px;width:100%;max-width:480px;max-height:80vh;overflow-y:auto;border-top:1px solid #222;}
    .modal-handle{width:36px;height:4px;background:#333;border-radius:2px;margin:0 auto 20px;}
    .modal-date{font-size:22px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;letter-spacing:2px;margin-bottom:16px;color:var(--accent);}
    .modal-section-lbl{font-size:10px;letter-spacing:3px;color:#444;margin-bottom:8px;margin-top:16px;}
    .modal-row{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:#0a0a0a;border-radius:6px;margin-bottom:4px;}
    .modal-close{width:100%;padding:14px;background:#1a1a1a;border:none;border-radius:10px;color:#888;font-size:14px;cursor:pointer;margin-top:12px;font-family:-apple-system,BlinkMacSystemFont,'Helvetica Neue',sans-serif;}

    /* HABITS */
    .habit-item{display:flex;align-items:center;gap:14px;padding:13px 16px;margin:0 20px 8px;background:var(--card);border-radius:10px;border:1px solid var(--border);cursor:pointer;transition:all 0.15s;}
    .habit-item.done{background:#0d1a0d;border-color:#1a3a1a;}
    .habit-check{width:22px;height:22px;border-radius:5px;border:2px solid #333;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.15s;}
    .habit-check.checked{background:var(--accent);border-color:var(--accent);}
    .habit-check.checked::after{content:'‚úì';color:#000;font-size:12px;font-weight:bold;}
    .nut-card{display:flex;justify-content:space-between;align-items:center;padding:13px 16px;margin:0 20px 8px;background:var(--card);border-radius:8px;border:1px solid var(--border);}
    .vyv-box{margin:16px 20px 0;padding:16px;background:#0d1219;border-radius:10px;border:1px solid #1a2030;}
    .timeline-wrap{position:relative;padding:14px 20px 14px 40px;}
    .timeline-line{position:absolute;left:26px;top:20px;bottom:20px;width:2px;background:linear-gradient(to bottom,#00ff88,#ff6b35,#ff0055);border-radius:1px;}
    .tl-item{position:relative;margin-bottom:20px;}
    .tl-dot{position:absolute;left:-21px;top:5px;width:10px;height:10px;border-radius:50%;border:2px solid var(--bg);}
    .tl-week{font-size:14px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;letter-spacing:1px;}
    .tl-text{font-size:12px;color:#777;margin-top:3px;line-height:1.5;}
    .warn-box{margin:8px 20px 32px;padding:14px;background:#1a0d0d;border-radius:10px;border:1px solid #2e1a1a;}

    .content-area{padding-bottom:calc(48px + var(--sab));}
    .divider{height:1px;background:#1a1a1a;margin:16px 20px;}
    .saved-badge{position:fixed;bottom:calc(20px + var(--sab));left:50%;transform:translateX(-50%);background:var(--accent);color:#000;font-size:12px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;letter-spacing:2px;padding:8px 20px;border-radius:20px;z-index:50;opacity:0;transition:opacity 0.3s;pointer-events:none;}
    .saved-badge.show{opacity:1;}
  </style>
</head>
<body>
<div id="installBanner" style="display:none;position:fixed;bottom:0;left:0;right:0;z-index:200;background:#111;border-top:1px solid #00ff88;padding:14px 20px calc(14px + env(safe-area-inset-bottom));text-align:center">
  <div style="font-size:13px;color:#f0f0f0;margin-bottom:6px">Add to Home Screen for the full app experience</div>
  <div style="font-size:12px;color:#00ff88">Tap <strong>Share</strong> ‚Üí <strong>Add to Home Screen</strong></div>
  <div style="font-size:11px;color:#444;margin-top:4px">Then reopen from your home screen</div>
  <button onclick="document.getElementById('installBanner').style.display='none';localStorage.setItem('bannerDismissed','1')" 
    style="margin-top:10px;background:none;border:1px solid #333;border-radius:6px;color:#555;padding:6px 16px;font-size:12px;cursor:pointer">
    Dismiss
  </button>
</div>
<div id="app"></div>
<div class="saved-badge" id="savedBadge">SAVED ‚úì</div>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PHASES = [
  { id:1, name:"PHASE 1", subtitle:"Foundation", weeks:"Weeks 1‚Äì4", color:"#00ff88",
    days:[
      { name:"MONDAY", tag:"Push + Legs", warmup:"20 min incline walk (15% / 2.5mph)", cooldown:"15 min incline walk",
        exercises:[{n:"Goblet Squat",s:3,r:"8"},{n:"Dumbbell Bench Press",s:3,r:"8"},{n:"Overhead Dumbbell Press",s:3,r:"8"},{n:"Hip Thrusts (bodyweight)",s:3,r:"15"},{n:"Push-ups",s:2,r:"10"}]},
      { name:"TUESDAY", tag:"Pull + Core", warmup:"20 min incline walk (15% / 2.5mph)", cooldown:"15 min incline walk",
        exercises:[{n:"Dumbbell Rows",s:3,r:"10 each side"},{n:"Lat Pulldowns",s:3,r:"10"},{n:"Romanian Deadlifts (light)",s:3,r:"8"},{n:"Plank",s:3,r:"30 sec"},{n:"Dead Bugs",s:3,r:"10"}]},
      { name:"WEDNESDAY", tag:"Hips + Glutes + Mobility", warmup:"20 min incline walk (15% / 2.5mph)", cooldown:"15 min incline walk",
        exercises:[{n:"Bodyweight Hip Thrusts",s:4,r:"15"},{n:"Bodyweight Squats",s:3,r:"15"},{n:"Cable Pull-Throughs",s:3,r:"15"},{n:"Glute Bridge (3 sec pause)",s:3,r:"12"},{n:"Deep Squat Hold",s:1,r:"2 min"},{n:"Couch Stretch",s:1,r:"2 min each side"}]},
      { name:"THURSDAY", tag:"Full Body + Martial Arts", warmup:"20 min incline walk (15% / 2.5mph)", cooldown:"20 min incline walk",
        exercises:[{n:"Dumbbell Bench Press",s:3,r:"8"},{n:"Dumbbell Rows",s:3,r:"10"},{n:"Hip Thrusts",s:3,r:"12"},{n:"Band Punches",s:3,r:"20 each hand"},{n:"Med Ball Rotational Throws",s:3,r:"10 each side"},{n:"Shadowboxing",s:1,r:"5 min"}]},
    ]
  },
  { id:2, name:"PHASE 2", subtitle:"Build Strength", weeks:"Weeks 5‚Äì8", color:"#ff6b35",
    days:[
      { name:"MONDAY", tag:"Push + Legs", warmup:"20 min incline walk", cooldown:"15 min incline walk",
        exercises:[{n:"Barbell Squat",s:4,r:"6"},{n:"Barbell Bench Press",s:4,r:"6"},{n:"Overhead Barbell Press",s:3,r:"8"},{n:"Weighted Hip Thrusts",s:4,r:"10"},{n:"Plyometric Push-ups",s:3,r:"6"}]},
      { name:"TUESDAY", tag:"Pull + Posterior Chain", warmup:"20 min incline walk", cooldown:"15 min incline walk",
        exercises:[{n:"Deadlifts",s:4,r:"5"},{n:"Barbell Rows",s:4,r:"6"},{n:"Lat Pulldowns",s:4,r:"8"},{n:"Face Pulls",s:3,r:"15"},{n:"Plank",s:3,r:"45 sec"},{n:"Dead Bugs",s:3,r:"10"}]},
      { name:"WEDNESDAY", tag:"Hips + Glutes + Power", warmup:"20 min incline walk", cooldown:"15 min incline walk",
        exercises:[{n:"Weighted Hip Thrusts (heavy)",s:4,r:"12"},{n:"Romanian Deadlifts",s:4,r:"8"},{n:"Cable Pull-Throughs",s:3,r:"15"},{n:"Explosive Hip Thrusts",s:3,r:"8 fast"},{n:"Box Jumps",s:3,r:"5"},{n:"Med Ball Rotational Throws",s:3,r:"10 each side"}]},
      { name:"THURSDAY", tag:"Full Upper + Martial Arts", warmup:"20 min incline walk", cooldown:"20 min incline walk",
        exercises:[{n:"Bench Press",s:4,r:"6"},{n:"Barbell Rows",s:4,r:"6"},{n:"Overhead Press",s:3,r:"8"},{n:"Pull-ups / Lat Pulldowns",s:4,r:"8"},{n:"Band Punches",s:3,r:"20 each hand"},{n:"Plyometric Push-ups",s:3,r:"6"},{n:"Shadowboxing",s:1,r:"5 min"}]},
    ]
  },
  { id:3, name:"PHASE 3", subtitle:"Elite Mode", weeks:"Weeks 9‚Äì12", color:"#ff0055",
    days:[
      { name:"MONDAY", tag:"Heavy Push + Explosive Power", warmup:"20 min incline walk", cooldown:"15 min incline walk",
        exercises:[{n:"Barbell Squat (heavy)",s:5,r:"5"},{n:"Barbell Bench Press (heavy)",s:5,r:"5"},{n:"Overhead Press",s:4,r:"6"},{n:"Weighted Hip Thrusts (max)",s:4,r:"12"},{n:"Explosive Hip Thrusts",s:3,r:"8 fast"},{n:"Plyometric Push-ups",s:4,r:"6"},{n:"Box Jumps",s:3,r:"5"}]},
      { name:"TUESDAY", tag:"Heavy Pull + Core", warmup:"20 min incline walk", cooldown:"15 min incline walk",
        exercises:[{n:"Deadlifts (heavy)",s:5,r:"5"},{n:"Barbell Rows",s:5,r:"5"},{n:"Weighted Pull-ups / Lat Pulldowns",s:4,r:"8"},{n:"Face Pulls",s:3,r:"15"},{n:"Farmers Carries",s:3,r:"40 meters"},{n:"Plank",s:3,r:"60 sec"},{n:"Hollow Body Holds",s:3,r:"30 sec"}]},
      { name:"WEDNESDAY", tag:"Power + Martial Arts + Performance", warmup:"20 min incline walk", cooldown:"15 min incline walk",
        exercises:[{n:"Weighted Hip Thrusts (explosive)",s:5,r:"10"},{n:"Romanian Deadlifts",s:4,r:"8"},{n:"Cable Pull-Throughs",s:4,r:"15"},{n:"Med Ball Rotational Throws",s:4,r:"10 each side"},{n:"Band Punches",s:4,r:"20 each hand"},{n:"Box Jumps",s:3,r:"5"},{n:"Glute Bridge (3 sec pause)",s:3,r:"12"},{n:"Shadowboxing",s:1,r:"10 min"}]},
      { name:"THURSDAY", tag:"Full Body Elite + Cardio", warmup:"20 min incline walk", cooldown:"20 min incline walk",
        exercises:[{n:"Bench Press",s:5,r:"5"},{n:"Deadlifts (heavy)",s:3,r:"3"},{n:"Barbell Rows",s:4,r:"6"},{n:"Weighted Pull-ups",s:4,r:"6"},{n:"Overhead Press",s:4,r:"6"},{n:"Band Punches",s:4,r:"20 each hand"},{n:"Farmers Carries",s:3,r:"40 meters"},{n:"Shadowboxing",s:1,r:"10 min"}]},
    ]
  }
];

// Body fix routines added to every workout day
const BODY_FIX = [
  {n:"Chin Tucks", detail:"Pull chin back like making double chin. Hold 5 sec. 10 reps. Best tech neck fix.", type:"techneck"},
  {n:"Cat-Cow", detail:"On hands & knees, arch and round back slowly. 10 reps. Relieves sciatica + spine.", type:"sciatica"},
  {n:"Piriformis Stretch", detail:"Cross ankle over knee, lean forward. 60 sec each side. Direct sciatica relief.", type:"sciatica"},
  {n:"Hip Flexor Stretch", detail:"Kneeling lunge, sink hips forward. 2 min each side. Sciatica + mobility.", type:"mobility"},
  {n:"Standing Hamstring Hang", detail:"Fold forward, soft knees, hang 60 sec. Touches toes in 8 weeks.", type:"flexibility"},
  {n:"Doorway Chest Stretch", detail:"Arms at 90¬∞ on doorframe, lean forward. 30 sec. Tech neck fix.", type:"techneck"},
  {n:"Couch Stretch", detail:"Back foot elevated on wall/bench, sink hips. 2 min each side. Hip mobility.", type:"mobility"},
  {n:"Child's Pose", detail:"Arms forward, sit back on heels. 60 sec. Decompresses lower spine.", type:"sciatica"},
];

const FRIDAY_PLAN = [
  {t:"20 min incline walk ‚Äî easy pace", d:"Get blood moving. Not a workout, just activation."},
  {t:"Foam rolling ‚Äî full body", d:"Quads, hamstrings, glutes, upper back. 2 min each."},
  {t:"Band pull-aparts 3√ó20", d:"Fixes tech neck posture. Light band."},
  {t:"Face pulls 3√ó15", d:"Keeps shoulders healthy for the week ahead."},
  {t:"Weighted hip thrusts 3√ó10", d:"Moderate weight. Maintain glute activation."},
  {t:"Plank 3√ó45 sec", d:"Core maintenance."},
  {t:"Shadowboxing 10 min", d:"Stay sharp for Saturday HIIT and martial arts."},
  {t:"Chin tucks 3√ó10", d:"Tech neck ‚Äî do these slowly with intention."},
  {t:"Piriformis stretch ‚Äî 60 sec each side", d:"Non-negotiable for sciatica management."},
  {t:"Hip flexor stretch ‚Äî 2 min each side", d:"Releases compression from the week."},
  {t:"Standing hamstring hang 60 sec", d:"Consistency here is what gets you touching toes."},
];

const SATURDAY_PLAN = [
  {t:"Eat solid meal 90 min before training", d:"Rice, chicken, banana. Fuel for HIIT intensity."},
  {t:"Hydrate more than usual today", d:"HIIT + Vyvanse = highest sweat output of the week."},
  {t:"HIIT Training ‚Äî go hard", d:"This is your cardio and conditioning day. Leave nothing."},
  {t:"Martial Arts", d:"Apply your hip power and rotational strength here."},
  {t:"Post-training stretch ‚Äî 10 min minimum", d:"Hips, hamstrings, shoulders, neck. Speeds up weekly recovery."},
  {t:"Piriformis stretch after class", d:"60 sec each side. Prevents sciatica flare after HIIT."},
  {t:"Cold shower to finish", d:"30 sec cold at the end. Reduces inflammation. Boosts blood flow rebound."},
  {t:"Protein within 30 min of finishing", d:"Shake or meal. Muscle repair window is open."},
];

const SUNDAY_PLAN = [
  {t:"No alarm ‚Äî sleep until body wakes", d:"Testosterone and growth hormone peak during extended sleep."},
  {t:"Morning sunlight walk 20‚Äì30 min", d:"Resets cortisol. Improves sleep quality all week."},
  {t:"Eat highest protein day ‚Äî 180g+", d:"Muscles repairing from full week. Feed them."},
  {t:"Hydrate heavily all day", d:"Recovery is measurably faster when fully hydrated."},
  {t:"Magnesium glycinate before bed", d:"Most important dose of the week. Recovery and BP."},
  {t:"Meal prep for the week", d:"Cook proteins, prep shakes, set out supplements. Win Monday before it starts."},
  {t:"Full stretch routine", d:"2 rounds of all body fix stretches. Body maintenance day."},
  {t:"No screens 30 min before bed", d:"Protects melatonin and sleep quality."},
  {t:"In bed by 10:30‚Äì11pm", d:"8 hrs before 7am wake. Protect your testosterone window."},
];

// PILL PACKS organized by time of day
const PILL_PACKS = [
  {
    id:'morning', time:'MORNING PACK', emoji:'üåÖ', color:'#00ff88',
    note:'Take with breakfast BEFORE Vyvanse kicks in',
    items:[
      {n:"Protein Shake (Pea Protein + Creatine)", dose:"1 scoop in water/milk", benefit:"31g protein + 5g creatine ‚Äî muscle and strength foundation"},
      {n:"Zinc + Beet Root Gummies", dose:"2 gummies", benefit:"Zinc ¬∑ Beet Root ¬∑ L-Citrulline ¬∑ L-Arginine ¬∑ Pine Bark ¬∑ B-Complex"},
      {n:"Vitamin D3 5,000 IU + K2", dose:"1 softgel", benefit:"Testosterone support ¬∑ calcium to bones not arteries"},
      {n:"Ashwagandha 300mg", dose:"1 softgel", benefit:"Cortisol reduction ¬∑ testosterone support ¬∑ take with food"},
    ]
  },
  {
    id:'preworkout', time:'PRE-WORKOUT PACK', emoji:'‚ö°', color:'#ff6b35',
    note:'30‚Äì45 min before training ‚Äî skip on rest days',
    items:[
      {n:"L-Arginine + L-Citrulline + Beet Root + Pine Bark Capsules", dose:"3 capsules", benefit:"Nitric oxide surge ¬∑ max blood flow ¬∑ BP ¬∑ erection quality"},
      {n:"Fish Oil 4,200mg", dose:"3 softgels", benefit:"Cardiovascular protection ¬∑ inflammation reduction ¬∑ brain function"},
    ]
  },
  {
    id:'evening', time:'EVENING PACK', emoji:'üåô', color:'#6699ff',
    note:'Take 30‚Äì60 min before bed ‚Äî most important pack of the day',
    items:[
      {n:"Magnesium Glycinate + L-Theanine", dose:"3 softgels", benefit:"300mg mag ¬∑ 300mg L-theanine ¬∑ BP down ¬∑ deep sleep ¬∑ full recovery"},
      {n:"Ashwagandha 300mg (2nd dose)", dose:"1 softgel", benefit:"600mg total daily = clinical dose for testosterone and cortisol"},
    ]
  },
];

// Flat list for checkbox tracking
const SUPPLEMENTS = PILL_PACKS.flatMap(p=>p.items);

// Sunday prep checklist for packing the week
const PREP_CHECKLIST = [
  {t:"Count morning packs needed (7 days)", d:"Protein shake + gummies + D3 + Ashwagandha morning dose"},
  {t:"Count pre-workout packs needed (4 days Mon‚ÄìThu)", d:"L-Arg/Citrulline capsules + Fish Oil ‚Äî skip Fri/Sat/Sun"},
  {t:"Count evening packs needed (7 days)", d:"Magnesium Glycinate + Ashwagandha evening dose"},
  {t:"Fill and label 7 morning pouches", d:"Write M/T/W/TH/F/SA/SU on each ¬∑ check AM box"},
  {t:"Fill and label 4 pre-workout pouches", d:"Write MON/TUE/WED/THU ¬∑ check Other box"},
  {t:"Fill and label 7 evening pouches", d:"Write each day ¬∑ check PM box"},
  {t:"Set pouches out somewhere visible", d:"Kitchen counter or gym bag ‚Äî out of sight = forgotten"},
  {t:"Restock any supplements running low", d:"Check all bottles now so you're not scrambling midweek"},
  {t:"Prep protein shakes for the week", d:"Pre-measure scoops into small bags or just set the tub out"},
  {t:"Meal prep proteins for the week", d:"Chicken, ground beef, eggs ‚Äî cook in bulk, refrigerate"},
  {t:"Set out gym bag and workout clothes", d:"Remove every excuse not to go Monday morning"},
];

const SEX_CHECKLIST = [
  {n:"Kegels + Reverse Kegels", d:"10 regular √ó 5 sec + 10 reverse ‚Äî full pelvic floor control"},
  {n:"Deep squat hold 2 min", d:"Blood flow to pelvis"},
  {n:"L-Citrulline taken", d:"3‚Äì6g ‚Äî nitric oxide for blood flow where it counts"},
  {n:"No alcohol today", d:"Kills erections and testosterone"},
  {n:"No adult sites today", d:"Rewires brain away from real intimacy ‚Äî biggest silent performance killer"},
  {n:"Cold shower finish", d:"Rebound blood flow effect after every workout"},
  {n:"8hrs sleep TARGET", d:"Most testosterone produced during deep sleep"},
];

const HABITS = [
  {icon:"üíß", text:"3 liters of water"},
  {icon:"üò¥", text:"7‚Äì9 hours sleep"},
  {icon:"ü•©", text:"150‚Äì180g protein"},
  {icon:"üçΩÔ∏è", text:"Big meal when Vyvanse wears off"},
  {icon:"üíä", text:"All supplements taken"},
  {icon:"üßò", text:"Body fix stretches done"},
  {icon:"üìè", text:"Weights tracked in app"},
];

const NUTRITION = [
  {label:"Calories", value:"2,800‚Äì3,200", color:"#ff6b35"},
  {label:"Protein", value:"150‚Äì180g", color:"#00ff88"},
  {label:"Carbs", value:"300‚Äì350g", color:"#ffcc00"},
  {label:"Fats", value:"80‚Äì100g", color:"#ff88aa"},
];

const TIMELINE = [
  {week:"WEEK 2", text:"Better sleep, more energy, less sluggish", color:"#00ff88"},
  {week:"WEEK 4", text:"BP dropping, stronger, habits locked in", color:"#00ff88"},
  {week:"WEEK 6", text:"Visible muscle, better performance in bed", color:"#ff6b35"},
  {week:"WEEK 8", text:"Stronger, better cardio, striking power building", color:"#ff6b35"},
  {week:"WEEK 10", text:"Looking great, martial arts better, can touch toes", color:"#ff0055"},
  {week:"WEEK 12", text:"New body, new BP, hitting harder, lasting longer üî•", color:"#ff0055"},
];

// Day constants
const ALL_DAYS = ['MON','TUE','WED','THU','FRI','SAT','SUN'];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadDB(){try{return JSON.parse(localStorage.getItem('eliteV4')||'{}');}catch(e){return {};}}
function saveDB(){try{localStorage.setItem('eliteV4',JSON.stringify(DB));showSaved();}catch(e){}}
function showSaved(){
  const b=document.getElementById('savedBadge');
  if(!b)return;
  b.classList.add('show');
  clearTimeout(window._st);
  window._st=setTimeout(()=>b.classList.remove('show'),1400);
}

let DB=loadDB();
let UI={
  activePhase: DB.activePhase||0,
  activeDay: DB.activeDay||'MON',
  activeTab: 'workout',
  calYear: new Date().getFullYear(),
  calMonth: new Date().getMonth(),
  modalDate: null,
  openEx: null,
};

function todayStr(){
  const d=new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}
function dateLabel(s){
  if(!s)return'';
  const[y,m,d]=s.split('-');
  const M=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  return`${M[parseInt(m)-1]} ${parseInt(d)}, ${y}`;
}
function getDowStr(dateStr){
  const[y,m,d]=dateStr.split('-');
  return ALL_DAYS[new Date(parseInt(y),parseInt(m)-1,parseInt(d)).getDay()===0?6:new Date(parseInt(y),parseInt(m)-1,parseInt(d)).getDay()-1];
}
function todayDow(){
  const dow=new Date().getDay(); // 0=sun
  // map to MON=0...SUN=6
  return ALL_DAYS[dow===0?6:dow-1];
}

function getDD(date){
  if(!DB.days)DB.days={};
  if(!DB.days[date])DB.days[date]={ex:{},w:{},bf:{},rec:{},supp:{},sex:{},habits:{}};
  return DB.days[date];
}
function setAccent(c){document.documentElement.style.setProperty('--accent',c);}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function render(){
  const phase=PHASES[UI.activePhase];
  const today=todayStr();
  const dd=getDD(today);
  setAccent(phase.color);

  // Calculate header progress based on active day
  let pct=0;
  const ad=UI.activeDay;
  if(ad==='FRI'){
    const done=FRIDAY_PLAN.filter((_,i)=>dd.rec[`fri-${i}`]).length;
    pct=Math.round(done/FRIDAY_PLAN.length*100);
  } else if(ad==='SAT'){
    const done=SATURDAY_PLAN.filter((_,i)=>dd.rec[`sat-${i}`]).length;
    pct=Math.round(done/SATURDAY_PLAN.length*100);
  } else if(ad==='SUN'){
    const done=SUNDAY_PLAN.filter((_,i)=>dd.rec[`sun-${i}`]).length;
    pct=Math.round(done/SUNDAY_PLAN.length*100);
  } else {
    const dayIdx=['MON','TUE','WED','THU'].indexOf(ad);
    if(dayIdx>=0){
      const exs=phase.days[dayIdx].exercises;
      const totalItems=exs.length+BODY_FIX.length;
      const exDone=exs.filter((_,i)=>dd.ex[`${UI.activePhase}-${dayIdx}-${i}`]).length;
      const bfDone=BODY_FIX.filter((_,i)=>dd.bf[`bf-${dayIdx}-${i}`]).length;
      pct=Math.round((exDone+bfDone)/totalItems*100);
    }
  }

  const dowLabel=todayDow();

  document.getElementById('app').innerHTML=`
    <div class="header">
      <div>
        <div class="h-eyebrow bebas">ELITE TRAINING</div>
        <div class="h-phase bebas">${phase.name}</div>
        <div class="h-sub" style="color:${phase.color}">${phase.weeks} ¬∑ ${phase.subtitle}</div>
        <div class="h-date">${dowLabel}, ${dateLabel(today)}</div>
      </div>
      <div class="prog-circle">
        <div class="prog-num">${pct}</div>
        <div class="prog-pct">%</div>
      </div>
    </div>

    <div class="tabs">
      ${['workout','supplements','calendar','habits'].map(t=>`
        <button class="tab-btn bebas ${UI.activeTab===t?'active':''}" onclick="switchTab('${t}')">
          ${t==='supplements'?'SUPPS':t.toUpperCase()}
        </button>`).join('')}
    </div>

    <div class="content-area">
      ${UI.activeTab==='workout' ? renderWorkoutTab(phase,today,dd) : ''}
      ${UI.activeTab==='supplements' ? renderSupplements(today,dd) : ''}
      ${UI.activeTab==='calendar' ? renderCalendar() : ''}
      ${UI.activeTab==='habits' ? renderHabits(today,dd) : ''}
    </div>

    ${UI.modalDate ? renderModal(UI.modalDate) : ''}
  `;

  // Bind weight inputs after render
  if(UI.activeTab==='workout'){
    document.querySelectorAll('.weight-input').forEach(inp=>{
      const key=inp.dataset.key;
      const dd2=getDD(today);
      if(key&&dd2.w[key])inp.value=dd2.w[key];
      inp.addEventListener('input',e=>{getDD(today).w[key]=e.target.value;saveDB();});
      inp.addEventListener('focus',()=>inp.scrollIntoView({behavior:'smooth',block:'center'}));
    });
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WORKOUT TAB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderWorkoutTab(phase,today,dd){
  const ad=UI.activeDay;

  // Day tabs row
  const dayTabsHTML=`
    <div class="day-tabs">
      ${ALL_DAYS.map(d=>{
        let cls='day-tab';
        if(d==='SUN') cls+=' rest-day';
        else if(d==='FRI') cls+=' recovery-day';
        else if(d==='SAT') cls+=' hiit-day';
        if(ad===d) cls+=' active';
        return `<button class="${cls}" onclick="switchDay('${d}')">${d}</button>`;
      }).join('')}
    </div>`;

  if(ad==='FRI') return dayTabsHTML + renderFriday(today,dd);
  if(ad==='SAT') return dayTabsHTML + renderSaturday(today,dd);
  if(ad==='SUN') return dayTabsHTML + renderSunday(today,dd);

  // MON‚ÄìTHU
  const dayIdx=['MON','TUE','WED','THU'].indexOf(ad);
  const day=phase.days[dayIdx];
  const exDone=day.exercises.filter((_,i)=>dd.ex[`${UI.activePhase}-${dayIdx}-${i}`]).length;
  const bfDone=BODY_FIX.filter((_,i)=>dd.bf[`bf-${dayIdx}-${i}`]).length;
  const totalItems=day.exercises.length+BODY_FIX.length;
  const pct=Math.round((exDone+bfDone)/totalItems*100);

  return dayTabsHTML + `
    <div class="phase-row">
      ${PHASES.map((p,i)=>`
        <button class="phase-btn bebas ${UI.activePhase===i?'active':''}"
          style="${UI.activePhase===i?`background:${p.color};color:#000;border-color:${p.color}`:''}"
          onclick="switchPhase(${i})">P${p.id}</button>`).join('')}
    </div>

    <div class="day-card">
      <div class="day-name bebas">${day.name}</div>
      <div class="day-tag">${day.tag}</div>
    </div>

    <div class="info-box warm">
      <span class="box-icon">üî•</span>
      <div><div class="box-lbl">WARM-UP</div><div class="box-txt" style="color:#00ff88">${day.warmup}</div></div>
    </div>

    <div class="prog-bar-wrap">
      <div class="prog-bar-labels"><span>TOTAL PROGRESS (workout + body fix)</span><span style="color:${phase.color}">${exDone+bfDone}/${totalItems}</span></div>
      <div class="prog-bar-track"><div class="prog-bar-fill" style="width:${pct}%"></div></div>
    </div>

    <div class="ex-section">
      <div class="section-lbl">EXERCISES ‚Äî TAP ‚úì TO COMPLETE ¬∑ TAP NAME FOR WEIGHT</div>
      ${day.exercises.map((ex,i)=>{
        const key=`${UI.activePhase}-${dayIdx}-${i}`;
        const isDone=!!dd.ex[key];
        const isOpen=UI.openEx===key;
        const w=dd.w[key]||'';
        const noWeight=['plank','shadowbox','hold','stretch','couch','bug','jump','carry'].some(k=>ex.n.toLowerCase().includes(k));
        return `
          <div class="ex-item ${isDone?'done':''}">
            <div class="ex-top">
              <div class="ex-check ${isDone?'checked':''}" onclick="toggleEx('${key}','ex')"></div>
              <div class="ex-info" onclick="toggleWeight('${key}')">
                <div class="ex-name">${ex.n}</div>
                <div class="ex-note">${ex.s} sets${w?' ¬∑ <span style="color:var(--accent)">'+w+'lbs</span>':''}</div>
              </div>
              <div class="ex-reps-badge">${ex.s}√ó${ex.r}</div>
            </div>
            ${!noWeight?`
            <div class="ex-weight ${isOpen?'open':''}">
              <div class="weight-row">
                <span class="weight-lbl">WEIGHT</span>
                <input class="weight-input" type="number" inputmode="decimal" placeholder="0" data-key="${key}"/>
                <span class="weight-unit">lbs</span>
              </div>
              <div class="weight-note">Auto-saved ¬∑ view past weights in calendar</div>
            </div>`:''}
          </div>`;
      }).join('')}
    </div>

    <div class="divider"></div>

    <div class="ex-section" style="margin-top:4px">
      <div class="section-lbl blue">üß† BODY FIX ‚Äî TECH NECK ¬∑ SCIATICA ¬∑ FLEXIBILITY</div>
      <div style="font-size:11px;color:#444;margin-bottom:12px;padding:0 0 4px">Do these after your workout or during cooldown</div>
      ${BODY_FIX.map((bf,i)=>{
        const key=`bf-${dayIdx}-${i}`;
        const isDone=!!dd.bf[key];
        return `
          <div class="ex-item body-item ${isDone?'done':''}" style="${isDone?'':'border-color:#1a1a2e'}">
            <div class="ex-top" onclick="toggleBF('${key}')">
              <div class="ex-check blue-check ${isDone?'checked':''}"></div>
              <div class="ex-info">
                <div class="ex-name">${bf.n}</div>
                <div class="ex-note" style="color:#6699ff88">${bf.detail}</div>
              </div>
              <div class="ex-reps-badge blue">${bf.type==='techneck'?'üñ•Ô∏è':bf.type==='sciatica'?'‚ö°':bf.type==='flexibility'?'ü¶µ':'ü¶µ'}</div>
            </div>
          </div>`;
      }).join('')}
    </div>

    <div class="info-box cool" style="margin-top:14px">
      <span class="box-icon">‚ùÑÔ∏è</span>
      <div><div class="box-lbl">COOL-DOWN</div><div class="box-txt" style="color:#aa88ff">${day.cooldown}</div></div>
    </div>
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FRI / SAT / SUN VIEWS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderFriday(today,dd){
  const done=FRIDAY_PLAN.filter((_,i)=>dd.rec[`fri-${i}`]).length;
  return `
    <div style="padding:12px 20px 8px">
      <div style="font-size:22px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;color:#ffcc00;letter-spacing:2px">FRIDAY</div>
      <div style="font-size:12px;color:#666;margin-bottom:4px">Active Recovery ¬∑ 45 min max</div>
      <div style="font-size:11px;color:#ffcc00">${done}/${FRIDAY_PLAN.length} done ¬∑ Sets you up for Saturday</div>
    </div>
    <div class="info-box note" style="margin-top:8px">
      <span class="box-icon">üí°</span>
      <div><div class="box-lbl">GOAL</div><div class="box-txt" style="color:#ffcc00">Blood flow, tension release, prep for HIIT + martial arts</div></div>
    </div>
    <div class="prog-bar-wrap" style="margin-top:8px">
      <div class="prog-bar-labels"><span>PROGRESS</span><span style="color:#ffcc00">${done}/${FRIDAY_PLAN.length}</span></div>
      <div class="prog-bar-track"><div class="prog-bar-fill" style="width:${Math.round(done/FRIDAY_PLAN.length*100)}%;background:#ffcc00"></div></div>
    </div>
    <div style="padding:0 20px">
      <div class="section-lbl yellow">CHECKLIST ‚Äî TAP TO COMPLETE</div>
      ${FRIDAY_PLAN.map((item,i)=>{
        const key=`fri-${i}`;
        const isDone=!!dd.rec[key];
        return `
          <div class="rec-item ${isDone?'done':''}" onclick="toggleRec('${today}','${key}')">
            <div class="rec-check yellow-rc ${isDone?'checked':''}"></div>
            <div>
              <div class="rec-text">${item.t}</div>
              <div class="rec-detail">${item.d}</div>
            </div>
          </div>`;
      }).join('')}
    </div>`;
}

function renderSaturday(today,dd){
  const done=SATURDAY_PLAN.filter((_,i)=>dd.rec[`sat-${i}`]).length;
  return `
    <div style="padding:12px 20px 8px">
      <div style="font-size:22px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;color:#ff88aa;letter-spacing:2px">SATURDAY</div>
      <div style="font-size:12px;color:#666;margin-bottom:4px">HIIT + Martial Arts ¬∑ Peak Conditioning</div>
      <div style="font-size:11px;color:#ff88aa">${done}/${SATURDAY_PLAN.length} done</div>
    </div>
    <div class="info-box" style="margin-top:8px;background:#1a0d12;border:1px solid #3a1a22">
      <span class="box-icon">ü•ä</span>
      <div><div class="box-lbl">GOAL</div><div class="box-txt" style="color:#ff88aa">Max cardio, apply your week's training, set up recovery</div></div>
    </div>
    <div class="prog-bar-wrap" style="margin-top:8px">
      <div class="prog-bar-labels"><span>PROGRESS</span><span style="color:#ff88aa">${done}/${SATURDAY_PLAN.length}</span></div>
      <div class="prog-bar-track"><div class="prog-bar-fill" style="width:${Math.round(done/SATURDAY_PLAN.length*100)}%;background:#ff88aa"></div></div>
    </div>
    <div style="padding:0 20px">
      <div class="section-lbl pink">CHECKLIST ‚Äî TAP TO COMPLETE</div>
      ${SATURDAY_PLAN.map((item,i)=>{
        const key=`sat-${i}`;
        const isDone=!!dd.rec[key];
        return `
          <div class="rec-item ${isDone?'done':''}" onclick="toggleRec('${today}','${key}')">
            <div class="rec-check pink-rc ${isDone?'checked':''}"></div>
            <div>
              <div class="rec-text">${item.t}</div>
              <div class="rec-detail">${item.d}</div>
            </div>
          </div>`;
      }).join('')}
    </div>`;
}

function renderSunday(today,dd){
  const recDone=SUNDAY_PLAN.filter((_,i)=>dd.rec[`sun-${i}`]).length;
  const prepDone=PREP_CHECKLIST.filter((_,i)=>dd.rec[`prep-${i}`]).length;
  const totalDone=recDone+prepDone;
  const totalItems=SUNDAY_PLAN.length+PREP_CHECKLIST.length;
  return `
    <div style="padding:12px 20px 8px">
      <div style="font-size:22px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;color:#00ff88;letter-spacing:2px">SUNDAY</div>
      <div style="font-size:12px;color:#666;margin-bottom:4px">Full Recovery ¬∑ Testosterone Recharge ¬∑ Week Prep</div>
      <div style="font-size:11px;color:#00ff88">${totalDone}/${totalItems} done</div>
    </div>
    <div class="info-box warm" style="margin-top:8px">
      <span class="box-icon">üí§</span>
      <div><div class="box-lbl">GOAL</div><div class="box-txt" style="color:#00ff88">Sleep, eat, stretch, prep your pill packs. Win the week before it starts.</div></div>
    </div>
    <div class="prog-bar-wrap" style="margin-top:8px">
      <div class="prog-bar-labels"><span>TOTAL PROGRESS</span><span style="color:#00ff88">${totalDone}/${totalItems}</span></div>
      <div class="prog-bar-track"><div class="prog-bar-fill" style="width:${Math.round(totalDone/totalItems*100)}%"></div></div>
    </div>

    <div style="padding:0 20px">
      <div class="section-lbl">RECOVERY CHECKLIST</div>
      ${SUNDAY_PLAN.map((item,i)=>{
        const key=`sun-${i}`;
        const isDone=!!dd.rec[key];
        return `
          <div class="rec-item ${isDone?'done':''}" onclick="toggleRec('${today}','${key}')">
            <div class="rec-check ${isDone?'checked':''}"></div>
            <div>
              <div class="rec-text">${item.t}</div>
              <div class="rec-detail">${item.d}</div>
            </div>
          </div>`;
      }).join('')}
    </div>

    <div style="height:1px;background:#1a1a1a;margin:16px 20px"></div>

    <div style="padding:0 20px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div class="section-lbl" style="margin:0;color:#ffcc00">üíä SUNDAY PILL PACK PREP</div>
        <div style="font-size:12px;color:#ffcc00;font-family:Impact,'Arial Narrow','Arial Black',sans-serif">${prepDone}/${PREP_CHECKLIST.length}</div>
      </div>
      <div style="background:#1a1a0d;border-radius:8px;padding:10px 14px;border:1px solid #2e2e1a;font-size:12px;color:#ffcc00;margin-bottom:12px;line-height:1.6">
        üõçÔ∏è Fill your pill pouches now. Label each with the day and time (AM / Pre-WO / PM). Grab and go all week ‚Äî no thinking, no forgetting.
      </div>
      ${PREP_CHECKLIST.map((item,i)=>{
        const key=`prep-${i}`;
        const isDone=!!dd.rec[key];
        return `
          <div class="rec-item ${isDone?'done':''}" onclick="toggleRec('${today}','${key}')">
            <div class="rec-check yellow-rc ${isDone?'checked':''}"></div>
            <div>
              <div class="rec-text">${item.t}</div>
              <div class="rec-detail">${item.d}</div>
            </div>
          </div>`;
      }).join('')}
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUPPLEMENTS TAB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderSupplements(today,dd){
  // count total items across all packs
  const totalItems = SUPPLEMENTS.length;
  const suppDone = SUPPLEMENTS.filter((_,i)=>dd.supp[i]).length;
  const sexDone = SEX_CHECKLIST.filter((_,i)=>dd.sex[i]).length;
  
  // Build offset map for flat index
  let offset=0;
  const packHTML = PILL_PACKS.map(pack=>{
    const packOffset=offset;
    const packDone=pack.items.filter((_,i)=>dd.supp[packOffset+i]).length;
    const html=`
      <div style="margin:0 20px 16px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div style="display:flex;align-items:center;gap:8px">
            <span style="font-size:18px">${pack.emoji}</span>
            <div>
              <div style="font-size:16px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;letter-spacing:1px;color:${pack.color}">${pack.time}</div>
              <div style="font-size:11px;color:#555;margin-top:1px">${pack.note}</div>
            </div>
          </div>
          <div style="font-size:12px;color:${pack.color};font-family:Impact,'Arial Narrow','Arial Black',sans-serif;flex-shrink:0">${packDone}/${pack.items.length}</div>
        </div>
        <div style="background:#111;border-radius:10px;border:1px solid #1a1a1a;overflow:hidden">
          ${pack.items.map((item,i)=>{
            const globalIdx=packOffset+i;
            const done=!!dd.supp[globalIdx];
            return `
              <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;border-bottom:1px solid #1a1a1a;cursor:pointer;${done?'background:#0d1a0d;':''};transition:all 0.15s" 
                onclick="toggleSupp('${today}',${globalIdx})">
                <div style="width:20px;height:20px;border-radius:4px;border:2px solid ${done?pack.color:'#333'};background:${done?pack.color:'none'};display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.15s">
                  ${done?'<span style="color:#000;font-size:11px;font-weight:bold">‚úì</span>':''}
                </div>
                <div style="flex:1">
                  <div style="font-size:13px;${done?'color:#444;text-decoration:line-through':'color:#e0e0e0'}">${item.n}</div>
                  <div style="font-size:10px;color:#555;margin-top:2px">${item.dose} ¬∑ ${item.benefit}</div>
                </div>
              </div>`;
          }).join('')}
        </div>
      </div>`;
    offset+=pack.items.length;
    return html;
  }).join('');

  return `
    <div style="padding:14px 20px 8px;display:flex;justify-content:space-between;align-items:flex-end">
      <div>
        <div class="section-lbl" style="margin:0 0 2px">TODAY ¬∑ ${dateLabel(today)}</div>
        <div style="font-size:11px;color:#555;margin-top:2px">Pre-pack on Sunday ¬∑ grab and go all week</div>
      </div>
      <div style="text-align:right">
        <div style="font-size:11px;color:var(--accent)">${suppDone}/${totalItems} taken</div>
        <div style="font-size:11px;color:#ff88aa;margin-top:2px">${sexDone}/${SEX_CHECKLIST.length} habits</div>
      </div>
    </div>

    <div style="margin:8px 20px 16px;background:#0d1a12;border-radius:8px;padding:10px 14px;border:1px solid #1a2e1f;font-size:12px;color:#00ff88;line-height:1.6">
      üí° <strong>How to use:</strong> Every Sunday, fill your pill pouches for the week. Label each pouch with the day and time. Grab the right pouch in the morning, pre-workout, and evening. Check items off below as you take them.
    </div>

    ${packHTML}

    <div style="margin:0 20px 16px">
      <div class="section-lbl pink" style="margin-bottom:8px">‚ö° SEX GOD DAILY CHECKLIST</div>
      ${SEX_CHECKLIST.map((s,i)=>{
        const done=!!dd.sex[i];
        return `
          <div class="sex-item ${done?'done':''}" onclick="toggleSex('${today}',${i})">
            <div class="sex-check ${done?'checked':''}"></div>
            <div>
              <div style="font-size:14px;${done?'color:#444;text-decoration:line-through':''}">${s.n}</div>
              <div style="font-size:11px;color:#555;margin-top:2px">${s.d}</div>
            </div>
          </div>`;
      }).join('')}
    </div>

    <div style="margin:0 20px 16px;padding:14px;background:#1a0d0d;border-radius:10px;border:1px solid #2e1a1a;font-size:12px;color:#888;line-height:1.6">
      ‚ö†Ô∏è On Vyvanse, Wellbutrin & Sertraline. Clear all supplements with your doctor first.
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CALENDAR TAB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderCalendar(){
  const today=todayStr();
  const year=UI.calYear,month=UI.calMonth;
  const monthNames=['January','February','March','April','May','June','July','August','September','October','November','December'];
  const daysInMonth=new Date(year,month+1,0).getDate();
  const firstDay=new Date(year,month,1).getDay();
  const days=[];
  for(let i=0;i<firstDay;i++)days.push(null);
  for(let i=1;i<=daysInMonth;i++)days.push(i);

  function getStatus(d){
    if(!d)return'';
    const ds=`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const data=DB.days&&DB.days[ds];
    if(!data)return'';
    const exDone=Object.values(data.ex||{}).filter(Boolean).length;
    const recDone=Object.values(data.rec||{}).filter(Boolean).length;
    const suppDone=Object.values(data.supp||{}).filter(Boolean).length;
    const dow=new Date(parseInt(year),parseInt(month),parseInt(d)).getDay();
    if(dow===0)return recDone>=3?'rest':'';
    if(exDone>=3||suppDone>=5)return'trained';
    if(exDone>0||recDone>0)return'partial';
    return'';
  }

  let streak=0;
  const chk=new Date();
  while(streak<365){
    const ds=`${chk.getFullYear()}-${String(chk.getMonth()+1).padStart(2,'0')}-${String(chk.getDate()).padStart(2,'0')}`;
    const data=DB.days&&DB.days[ds];
    const active=data&&(Object.values(data.ex||{}).filter(Boolean).length>0||Object.values(data.rec||{}).filter(Boolean).length>0);
    if(active){streak++;chk.setDate(chk.getDate()-1);}else break;
  }
  const trainedDays=Object.entries(DB.days||{}).filter(([,v])=>Object.values(v.ex||{}).filter(Boolean).length>0||Object.values(v.rec||{}).filter(Boolean).length>0).length;

  const cells=days.map(d=>{
    if(!d)return`<div class="cal-day empty"></div>`;
    const ds=`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isToday=ds===today;
    const st=getStatus(d);
    const cls=['cal-day',isToday?'today':'',st].filter(Boolean).join(' ');
    return`<div class="${cls}" onclick="openModal('${ds}')">${d}</div>`;
  }).join('');

  return`
    <div class="cal-wrap">
      <div style="display:flex;gap:12px;margin-bottom:16px">
        <div style="flex:1;background:#111;border-radius:10px;padding:12px;border:1px solid #1a1a1a;text-align:center">
          <div style="font-size:28px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;color:var(--accent)">${streak}</div>
          <div style="font-size:10px;color:#444;letter-spacing:2px">DAY STREAK</div>
        </div>
        <div style="flex:1;background:#111;border-radius:10px;padding:12px;border:1px solid #1a1a1a;text-align:center">
          <div style="font-size:28px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;color:#ff6b35">${trainedDays}</div>
          <div style="font-size:10px;color:#444;letter-spacing:2px">ACTIVE DAYS</div>
        </div>
      </div>
      <div class="cal-nav">
        <button class="nav-btn" onclick="calPrev()">‚Äπ</button>
        <div class="cal-month">${monthNames[month]} ${year}</div>
        <button class="nav-btn" onclick="calNext()">‚Ä∫</button>
      </div>
      <div class="cal-grid">
        ${['S','M','T','W','T','F','S'].map(d=>`<div class="cal-dow">${d}</div>`).join('')}
        ${cells}
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:10px;margin-top:12px;padding:12px;background:#111;border-radius:8px;border:1px solid #1a1a1a">
        <div style="display:flex;align-items:center;gap:6px"><div style="width:12px;height:12px;border-radius:3px;background:var(--accent)"></div><span style="font-size:11px;color:#666">Trained</span></div>
        <div style="display:flex;align-items:center;gap:6px"><div style="width:12px;height:12px;border-radius:3px;background:#1a3a1a"></div><span style="font-size:11px;color:#666">Partial</span></div>
        <div style="display:flex;align-items:center;gap:6px"><div style="width:12px;height:12px;border-radius:3px;background:#1a1a2e"></div><span style="font-size:11px;color:#666">Recovery</span></div>
        <div style="display:flex;align-items:center;gap:6px"><div style="width:12px;height:12px;border-radius:3px;border:1px solid var(--accent)"></div><span style="font-size:11px;color:#666">Today</span></div>
      </div>
      <div style="margin-top:10px;font-size:11px;color:#444;text-align:center;letter-spacing:1px">TAP ANY DAY TO SEE YOUR LOG</div>
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderModal(dateStr){
  const data=DB.days&&DB.days[dateStr];
  let sections='';
  if(data){
    const exE=Object.entries(data.ex||{}).filter(([,v])=>v);
    if(exE.length){
      sections+=`<div class="modal-section-lbl">EXERCISES</div>${exE.map(([key])=>{
        const[p,d,i]=key.split('-').map(Number);
        const ex=PHASES[p]?.days[d]?.exercises[i];
        const w=data.w?.[key];
        return ex?`<div class="modal-row"><span style="font-size:13px;color:#ccc">${ex.n}</span><span style="font-size:13px;color:var(--accent)">${w?w+'lbs':ex.s+'√ó'+ex.r}</span></div>`:'';
      }).join('')}`;
    }
    const bfE=Object.entries(data.bf||{}).filter(([,v])=>v);
    if(bfE.length){
      sections+=`<div class="modal-section-lbl" style="color:#6699ff">BODY FIX DONE</div>${bfE.map(([key])=>{
        const i=parseInt(key.split('-')[2]);
        const bf=BODY_FIX[i];
        return bf?`<div class="modal-row"><span style="font-size:12px;color:#6699ff">${bf.n}</span><span style="color:#6699ff">‚úì</span></div>`:'';
      }).join('')}`;
    }
    const recE=Object.entries(data.rec||{}).filter(([,v])=>v);
    if(recE.length){
      sections+=`<div class="modal-section-lbl">RECOVERY / ACTIVITIES</div>${recE.map(([key])=>{
        let label='';
        if(key.startsWith('fri-'))label=FRIDAY_PLAN[parseInt(key.split('-')[1])]?.t;
        else if(key.startsWith('sat-'))label=SATURDAY_PLAN[parseInt(key.split('-')[1])]?.t;
        else if(key.startsWith('sun-'))label=SUNDAY_PLAN[parseInt(key.split('-')[1])]?.t;
        else if(key.startsWith('prep-'))label='üì¶ '+PREP_CHECKLIST[parseInt(key.split('-')[1])]?.t;
        return label?`<div class="modal-row"><span style="font-size:12px;color:#ccc">${label}</span><span style="color:#00ff88">‚úì</span></div>`:'';
      }).join('')}`;
    }
    const suppE=Object.entries(data.supp||{}).filter(([,v])=>v);
    if(suppE.length){
      sections+=`<div class="modal-section-lbl">SUPPLEMENTS</div>${suppE.map(([idx])=>{
        const s=SUPPLEMENTS[parseInt(idx)];
        return s?`<div class="modal-row"><span style="font-size:12px;color:#ccc">${s.n}</span><span style="font-size:11px;color:#555">${s.dose}</span></div>`:'';
      }).join('')}`;
    }
    const sexE=Object.entries(data.sex||{}).filter(([,v])=>v);
    if(sexE.length){
      sections+=`<div class="modal-section-lbl" style="color:#ff88aa">SEX GOD HABITS</div>${sexE.map(([idx])=>{
        const s=SEX_CHECKLIST[parseInt(idx)];
        return s?`<div class="modal-row"><span style="font-size:12px;color:#ff88aa">${s.n}</span><span>‚úì</span></div>`:'';
      }).join('')}`;
    }
  }
  if(!sections)sections=`<div style="font-size:13px;color:#444;text-align:center;padding:20px">No data recorded for this day.</div>`;
  return`
    <div class="modal-overlay" onclick="if(event.target===this)closeModal()">
      <div class="modal">
        <div class="modal-handle"></div>
        <div class="modal-date">${dateLabel(dateStr)}</div>
        ${sections}
        <button class="modal-close" onclick="closeModal()">CLOSE</button>
      </div>
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HABITS TAB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHabits(today,dd){
  const done=HABITS.filter((_,i)=>dd.habits[i]).length;
  return`
    <div style="padding:14px 0">
      <div style="padding:0 20px 12px;display:flex;justify-content:space-between;align-items:center">
        <div class="section-lbl" style="margin:0">DAILY NON-NEGOTIABLES</div>
        <div style="font-size:13px;color:var(--accent);font-family:Impact,'Arial Narrow','Arial Black',sans-serif">${done}/${HABITS.length}</div>
      </div>
      ${HABITS.map((h,i)=>{
        const isDone=!!dd.habits[i];
        return`
          <div class="habit-item ${isDone?'done':''}" onclick="toggleHabit('${today}',${i})">
            <div class="habit-check ${isDone?'checked':''}"></div>
            <span style="font-size:20px">${h.icon}</span>
            <div style="font-size:14px;${isDone?'color:#444':''}">${h.text}</div>
          </div>`;
      }).join('')}
      <div style="margin-top:20px">
        <div class="section-lbl" style="padding:0 20px;margin-bottom:10px">NUTRITION TARGETS</div>
        ${NUTRITION.map(n=>`
          <div class="nut-card">
            <div style="font-size:16px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;letter-spacing:1px">${n.label}</div>
            <div style="font-size:15px;font-weight:600;color:${n.color}">${n.value}</div>
          </div>`).join('')}
      </div>
      <div class="vyv-box">
        <div style="font-size:14px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;letter-spacing:1px;color:#6699ff;margin-bottom:8px">üíä VYVANSE EATING STRATEGY</div>
        <div style="font-size:12px;color:#666;line-height:2">üåÖ <strong style="color:#888">Morning:</strong> Eat big BEFORE it kicks in</div>
        <div style="font-size:12px;color:#666;line-height:2">‚òÄÔ∏è <strong style="color:#888">Midday:</strong> Protein shake when appetite is gone</div>
        <div style="font-size:12px;color:#666;line-height:2">üåô <strong style="color:#888">Evening:</strong> Biggest meal when it wears off</div>
      </div>
      <div style="margin:16px 20px 0">
        <div class="section-lbl" style="margin-bottom:10px">PROGRESS TIMELINE</div>
        <div class="timeline-wrap">
          <div class="timeline-line"></div>
          ${TIMELINE.map(t=>`
            <div class="tl-item">
              <div class="tl-dot" style="background:${t.color}"></div>
              <div class="tl-week bebas" style="color:${t.color}">${t.week}</div>
              <div class="tl-text">${t.text}</div>
            </div>`).join('')}
        </div>
      </div>
      <div class="warn-box">
        <div style="font-size:13px;font-family:Impact,'Arial Narrow','Arial Black',sans-serif;letter-spacing:1px;color:#ff0055;margin-bottom:8px">‚ö° STOP IMMEDIATELY IF:</div>
        ${['Chest tightness or pain','Dizziness or lightheadedness','Blurred vision','Severe headache during workout','Unusual shortness of breath'].map(w=>`<div style="font-size:12px;color:#666;padding:4px 0;border-bottom:1px solid #1a1a1a">¬∑ ${w}</div>`).join('')}
      </div>
    </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EVENT HANDLERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchTab(t){UI.activeTab=t;render();}
function switchPhase(i){UI.activePhase=i;DB.activePhase=i;saveDB();render();}
function switchDay(d){UI.activeDay=d;DB.activeDay=d;saveDB();render();}

function toggleEx(key,type){
  const dd=getDD(todayStr());
  dd.ex[key]=!dd.ex[key];
  saveDB();render();
}
function toggleBF(key){
  const dd=getDD(todayStr());
  dd.bf[key]=!dd.bf[key];
  saveDB();render();
}
function toggleRec(date,key){
  const dd=getDD(date);
  dd.rec[key]=!dd.rec[key];
  saveDB();render();
}
function toggleSupp(date,idx){
  const dd=getDD(date);
  dd.supp[idx]=!dd.supp[idx];
  saveDB();render();
}
function toggleSex(date,idx){
  const dd=getDD(date);
  dd.sex[idx]=!dd.sex[idx];
  saveDB();render();
}
function toggleHabit(date,idx){
  const dd=getDD(date);
  dd.habits[idx]=!dd.habits[idx];
  saveDB();render();
}
function toggleWeight(key){UI.openEx=UI.openEx===key?null:key;render();}
function calPrev(){if(UI.calMonth===0){UI.calMonth=11;UI.calYear--;}else UI.calMonth--;render();}
function calNext(){if(UI.calMonth===11){UI.calMonth=0;UI.calYear++;}else UI.calMonth++;render();}
function openModal(ds){UI.modalDate=ds;render();}
function closeModal(){UI.modalDate=null;render();}

// Auto-set today's day on load
UI.activeDay=todayDow();
render();

// iOS: Dynamically update sticky tab offset after render
function updateHeaderHeight(){
  const h=document.querySelector('.header');
  if(h){
    document.documentElement.style.setProperty('--header-h', h.offsetHeight+'px');
  }
}
updateHeaderHeight();
window.addEventListener('resize', updateHeaderHeight);

// iOS: Prevent rubber-band scroll on body but allow inside scrollable elements
document.addEventListener('touchmove', function(e){
  if(e.target===document.body) e.preventDefault();
},{passive:false});

// iOS: Fix 300ms tap delay
document.addEventListener('touchstart',function(){},{passive:true});

// iOS: Show install banner if not already installed and not dismissed
const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
const isStandalone = window.navigator.standalone === true;
const bannerDismissed = localStorage.getItem('bannerDismissed');
if(isIOS && !isStandalone && !bannerDismissed){
  setTimeout(()=>{
    const banner = document.getElementById('installBanner');
    if(banner) banner.style.display='block';
  }, 2000);
}

// iOS: Re-measure header after fonts load
document.fonts && document.fonts.ready && document.fonts.ready.then(()=>{
  updateHeaderHeight();
  render();
});
</script>
</body>
</html>
